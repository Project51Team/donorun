{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : global.webstomp = factory();\n})(this, function () {\n  'use strict';\n\n  var classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var slicedToArray = function () {\n    function sliceIterator(arr, i) {\n      var _arr = [];\n      var _n = true;\n      var _d = false;\n      var _e = undefined;\n\n      try {\n        for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n          _arr.push(_s.value);\n\n          if (i && _arr.length === i) break;\n        }\n      } catch (err) {\n        _d = true;\n        _e = err;\n      } finally {\n        try {\n          if (!_n && _i[\"return\"]) _i[\"return\"]();\n        } finally {\n          if (_d) throw _e;\n        }\n      }\n\n      return _arr;\n    }\n\n    return function (arr, i) {\n      if (Array.isArray(arr)) {\n        return arr;\n      } else if (Symbol.iterator in Object(arr)) {\n        return sliceIterator(arr, i);\n      } else {\n        throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n      }\n    };\n  }();\n\n  var toConsumableArray = function (arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    } else {\n      return Array.from(arr);\n    }\n  };\n\n  var VERSIONS = {\n    V1_0: '1.0',\n    V1_1: '1.1',\n    V1_2: '1.2',\n    // Versions of STOMP specifications supported\n    supportedVersions: function supportedVersions() {\n      return '1.2,1.1,1.0';\n    },\n    supportedProtocols: function supportedProtocols() {\n      return ['v10.stomp', 'v11.stomp', 'v12.stomp'];\n    }\n  };\n  var PROTOCOLS_VERSIONS = {\n    'v10.stomp': VERSIONS.V1_0,\n    'v11.stomp': VERSIONS.V1_1,\n    'v12.stomp': VERSIONS.V1_2\n  };\n\n  function getSupportedVersion(protocol, debug) {\n    var knownVersion = PROTOCOLS_VERSIONS[protocol];\n\n    if (!knownVersion && debug) {\n      debug('DEPRECATED: ' + protocol + ' is not a recognized STOMP version. In next major client version, this will close the connection.');\n    } // 2nd temporary fallback if the protocol\n    // does not match a supported STOMP version\n    // This fallback will be removed in next major version\n\n\n    return knownVersion || VERSIONS.V1_2;\n  } // Define constants for bytes used throughout the code.\n\n\n  var BYTES = {\n    // LINEFEED byte (octet 10)\n    LF: '\\x0A',\n    // NULL byte (octet 0)\n    NULL: '\\x00'\n  }; // utility function to trim any whitespace before and after a string\n\n  var trim = function trim(str) {\n    return str.replace(/^\\s+|\\s+$/g, '');\n  }; // from https://coolaj86.com/articles/unicode-string-to-a-utf-8-typed-array-buffer-in-javascript/\n\n\n  function unicodeStringToTypedArray(s) {\n    var escstr = encodeURIComponent(s);\n    var binstr = escstr.replace(/%([0-9A-F]{2})/g, function (match, p1) {\n      return String.fromCharCode('0x' + p1);\n    });\n    var arr = Array.prototype.map.call(binstr, function (c) {\n      return c.charCodeAt(0);\n    });\n    return new Uint8Array(arr);\n  } // from https://coolaj86.com/articles/unicode-string-to-a-utf-8-typed-array-buffer-in-javascript/\n\n\n  function typedArrayToUnicodeString(ua) {\n    var binstr = String.fromCharCode.apply(String, toConsumableArray(ua));\n    var escstr = binstr.replace(/(.)/g, function (m, p) {\n      var code = p.charCodeAt(0).toString(16).toUpperCase();\n\n      if (code.length < 2) {\n        code = '0' + code;\n      }\n\n      return '%' + code;\n    });\n    return decodeURIComponent(escstr);\n  } // Compute the size of a UTF-8 string by counting its number of bytes\n  // (and not the number of characters composing the string)\n\n\n  function sizeOfUTF8(s) {\n    if (!s) return 0;\n    return encodeURIComponent(s).match(/%..|./g).length;\n  }\n\n  function createId() {\n    var ts = new Date().getTime();\n    var rand = Math.floor(Math.random() * 1000);\n    return ts + '-' + rand;\n  } // [STOMP Frame](http://stomp.github.com/stomp-specification-1.1.html#STOMP_Frames) Class\n\n\n  var Frame = function () {\n    // Frame constructor\n    function Frame(command) {\n      var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var body = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n      classCallCheck(this, Frame);\n      this.command = command;\n      this.headers = headers;\n      this.body = body;\n    } // Provides a textual representation of the frame\n    // suitable to be sent to the server\n\n\n    createClass(Frame, [{\n      key: 'toString',\n      value: function toString() {\n        var _this = this;\n\n        var lines = [this.command],\n            skipContentLength = this.headers['content-length'] === false;\n        if (skipContentLength) delete this.headers['content-length'];\n        Object.keys(this.headers).forEach(function (name) {\n          var value = _this.headers[name];\n          lines.push(name + ':' + value);\n        });\n\n        if (this.body && !skipContentLength) {\n          lines.push('content-length:' + sizeOfUTF8(this.body));\n        }\n\n        lines.push(BYTES.LF + this.body);\n        return lines.join(BYTES.LF);\n      } // Unmarshall a single STOMP frame from a `data` string\n\n    }], [{\n      key: 'unmarshallSingle',\n      value: function unmarshallSingle(data) {\n        // search for 2 consecutives LF byte to split the command\n        // and headers from the body\n        var divider = data.search(new RegExp(BYTES.LF + BYTES.LF)),\n            headerLines = data.substring(0, divider).split(BYTES.LF),\n            command = headerLines.shift(),\n            headers = {},\n            body = '',\n            // skip the 2 LF bytes that divides the headers from the body\n        bodyIndex = divider + 2; // Parse headers in reverse order so that for repeated headers, the 1st\n        // value is used\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = headerLines.reverse()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var line = _step.value;\n            var idx = line.indexOf(':');\n            headers[trim(line.substring(0, idx))] = trim(line.substring(idx + 1));\n          } // Parse body\n          // check for content-length or topping at the first NULL byte found.\n\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        if (headers['content-length']) {\n          var len = parseInt(headers['content-length'], 10);\n          body = ('' + data).substring(bodyIndex, bodyIndex + len);\n        } else {\n          var chr = null;\n\n          for (var i = bodyIndex; i < data.length; i++) {\n            chr = data.charAt(i);\n            if (chr === BYTES.NULL) break;\n            body += chr;\n          }\n        }\n\n        return new Frame(command, headers, body);\n      } // Split the data before unmarshalling every single STOMP frame.\n      // Web socket servers can send multiple frames in a single websocket message.\n      // If the message size exceeds the websocket message size, then a single\n      // frame can be fragmented across multiple messages.\n      //\n      // `datas` is a string.\n      //\n      // returns an *array* of Frame objects\n\n    }, {\n      key: 'unmarshall',\n      value: function unmarshall(datas) {\n        // split and unmarshall *multiple STOMP frames* contained in a *single WebSocket frame*.\n        // The data is split when a NULL byte (followed by zero or many LF bytes) is found\n        var frames = datas.split(new RegExp(BYTES.NULL + BYTES.LF + '*')),\n            firstFrames = frames.slice(0, -1),\n            lastFrame = frames.slice(-1)[0],\n            r = {\n          frames: firstFrames.map(function (f) {\n            return Frame.unmarshallSingle(f);\n          }),\n          partial: ''\n        }; // If this contains a final full message or just a acknowledgement of a PING\n        // without any other content, process this frame, otherwise return the\n        // contents of the buffer to the caller.\n\n        if (lastFrame === BYTES.LF || lastFrame.search(RegExp(BYTES.NULL + BYTES.LF + '*$')) !== -1) {\n          r.frames.push(Frame.unmarshallSingle(lastFrame));\n        } else {\n          r.partial = lastFrame;\n        }\n\n        return r;\n      } // Marshall a Stomp frame\n\n    }, {\n      key: 'marshall',\n      value: function marshall(command, headers, body) {\n        var frame = new Frame(command, headers, body);\n        return frame.toString() + BYTES.NULL;\n      }\n    }]);\n    return Frame;\n  }(); // STOMP Client Class\n  //\n  // All STOMP protocol is exposed as methods of this class (`connect()`,\n  // `send()`, etc.)\n\n\n  var Client = function () {\n    function Client(ws) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      classCallCheck(this, Client); // cannot have default options object + destructuring in the same time in method signature\n\n      var _options$binary = options.binary,\n          binary = _options$binary === undefined ? false : _options$binary,\n          _options$heartbeat = options.heartbeat,\n          heartbeat = _options$heartbeat === undefined ? {\n        outgoing: 10000,\n        incoming: 10000\n      } : _options$heartbeat,\n          _options$debug = options.debug,\n          debug = _options$debug === undefined ? true : _options$debug,\n          _options$protocols = options.protocols,\n          protocols = _options$protocols === undefined ? [] : _options$protocols;\n      this.ws = ws;\n      this.ws.binaryType = 'arraybuffer';\n      this.isBinary = !!binary;\n      this.hasDebug = !!debug;\n      this.connected = false; // Heartbeat properties of the client\n      // outgoing: send heartbeat every 10s by default (value is in ms)\n      // incoming: expect to receive server heartbeat at least every 10s by default\n      // falsy value means no heartbeat hence 0,0\n\n      this.heartbeat = heartbeat || {\n        outgoing: 0,\n        incoming: 0\n      }; // maximum *WebSocket* frame size sent by the client. If the STOMP frame\n      // is bigger than this value, the STOMP frame will be sent using multiple\n      // WebSocket frames (default is 16KiB)\n\n      this.maxWebSocketFrameSize = 16 * 1024; // subscription callbacks indexed by subscriber's ID\n\n      this.subscriptions = {};\n      this.partialData = '';\n      this.protocols = protocols;\n    } // //// Debugging\n    //\n    // By default, debug messages are logged in the window's console if it is defined.\n    // This method is called for every actual transmission of the STOMP frames over the\n    // WebSocket.\n    //\n    // It is possible to set a `debug(message, data)` method\n    // on a client instance to handle differently the debug messages:\n    //\n    //     client.debug = function(str) {\n    //         // append the debug log to a #debug div\n    //         $(\"#debug\").append(str + \"\\n\");\n    //     };\n\n\n    createClass(Client, [{\n      key: 'debug',\n      value: function debug() {\n        var _console;\n\n        if (this.hasDebug) (_console = console).log.apply(_console, arguments);\n      } // [CONNECT Frame](http://stomp.github.com/stomp-specification-1.1.html#CONNECT_or_STOMP_Frame)\n      //\n      // The `connect` method accepts different number of arguments and types:\n      //\n      // * `connect(headers, connectCallback)`\n      // * `connect(headers, connectCallback, errorCallback)`\n      // * `connect(login, passcode, connectCallback)`\n      // * `connect(login, passcode, connectCallback, errorCallback)`\n      // * `connect(login, passcode, connectCallback, errorCallback, host)`\n      //\n      // The errorCallback is optional and the 2 first forms allow to pass other\n      // headers in addition to `client`, `passcode` and `host`.\n\n    }, {\n      key: 'connect',\n      value: function connect() {\n        var _this = this;\n\n        var _parseConnect2 = this._parseConnect.apply(this, arguments),\n            _parseConnect3 = slicedToArray(_parseConnect2, 3),\n            headers = _parseConnect3[0],\n            connectCallback = _parseConnect3[1],\n            errorCallback = _parseConnect3[2];\n\n        this.connectCallback = connectCallback;\n        this.debug('Opening Web Socket...');\n\n        this.ws.onmessage = function (evt) {\n          var data = evt.data;\n\n          if (evt.data instanceof ArrayBuffer) {\n            data = typedArrayToUnicodeString(new Uint8Array(evt.data));\n          }\n\n          _this.serverActivity = Date.now(); // heartbeat\n\n          if (data === BYTES.LF) {\n            _this.debug('<<< PONG');\n\n            return;\n          }\n\n          _this.debug('<<< ' + data); // Handle STOMP frames received from the server\n          // The unmarshall function returns the frames parsed and any remaining\n          // data from partial frames.\n\n\n          var unmarshalledData = Frame.unmarshall(_this.partialData + data);\n          _this.partialData = unmarshalledData.partial;\n          unmarshalledData.frames.forEach(function (frame) {\n            switch (frame.command) {\n              // [CONNECTED Frame](http://stomp.github.com/stomp-specification-1.1.html#CONNECTED_Frame)\n              case 'CONNECTED':\n                _this.debug('connected to server ' + frame.headers.server);\n\n                _this.connected = true;\n                _this.version = frame.headers.version;\n\n                _this._setupHeartbeat(frame.headers);\n\n                if (connectCallback) connectCallback(frame);\n                break;\n              // [MESSAGE Frame](http://stomp.github.com/stomp-specification-1.1.html#MESSAGE)\n\n              case 'MESSAGE':\n                // the `onreceive` callback is registered when the client calls\n                // `subscribe()`.\n                // If there is registered subscription for the received message,\n                // we used the default `onreceive` method that the client can set.\n                // This is useful for subscriptions that are automatically created\n                // on the browser side (e.g. [RabbitMQ's temporary\n                // queues](http://www.rabbitmq.com/stomp.html)).\n                var subscription = frame.headers.subscription;\n                var onreceive = _this.subscriptions[subscription] || _this.onreceive;\n\n                if (onreceive) {\n                  // 1.2 define ack header if ack is set to client\n                  // and this header must be used for ack/nack\n                  var messageID = _this.version === VERSIONS.V1_2 && frame.headers.ack || frame.headers['message-id']; // add `ack()` and `nack()` methods directly to the returned frame\n                  // so that a simple call to `message.ack()` can acknowledge the message.\n\n                  frame.ack = _this.ack.bind(_this, messageID, subscription);\n                  frame.nack = _this.nack.bind(_this, messageID, subscription);\n                  onreceive(frame);\n                } else {\n                  _this.debug('Unhandled received MESSAGE: ' + frame);\n                }\n\n                break;\n              // [RECEIPT Frame](http://stomp.github.com/stomp-specification-1.1.html#RECEIPT)\n              //\n              // The client instance can set its `onreceipt` field to a function taking\n              // a frame argument that will be called when a receipt is received from\n              // the server:\n              //\n              //     client.onreceipt = function(frame) {\n              //       receiptID = frame.headers['receipt-id'];\n              //       ...\n              //     }\n\n              case 'RECEIPT':\n                if (_this.onreceipt) _this.onreceipt(frame);\n                break;\n              // [ERROR Frame](http://stomp.github.com/stomp-specification-1.1.html#ERROR)\n\n              case 'ERROR':\n                if (errorCallback) errorCallback(frame);\n                break;\n\n              default:\n                _this.debug('Unhandled frame: ' + frame);\n\n            }\n          });\n        };\n\n        this.ws.onclose = function (event) {\n          _this.debug('Whoops! Lost connection to ' + _this.ws.url + ':', {\n            event: event\n          });\n\n          _this._cleanUp();\n\n          if (errorCallback) errorCallback(event);\n        };\n\n        this.ws.onopen = function () {\n          _this.debug('Web Socket Opened...'); // 1st protocol fallback on user 1st protocols options\n          // to prevent edge case where server does not comply and respond with a choosen protocol\n          // or when ws client does not handle protocol property very well\n\n\n          headers['accept-version'] = getSupportedVersion(_this.ws.protocol || _this.protocols[0], _this.debug.bind(_this)); // Check if we already have heart-beat in headers before adding them\n\n          if (!headers['heart-beat']) {\n            headers['heart-beat'] = [_this.heartbeat.outgoing, _this.heartbeat.incoming].join(',');\n          }\n\n          _this._transmit('CONNECT', headers);\n        };\n\n        if (this.ws.readyState === this.ws.OPEN) {\n          this.ws.onopen();\n        }\n      } // [DISCONNECT Frame](http://stomp.github.com/stomp-specification-1.1.html#DISCONNECT)\n\n    }, {\n      key: 'disconnect',\n      value: function disconnect(disconnectCallback) {\n        var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n        this._transmit('DISCONNECT', headers); // Discard the onclose callback to avoid calling the errorCallback when\n        // the client is properly disconnected.\n\n\n        this.ws.onclose = null;\n        this.ws.close();\n\n        this._cleanUp(); // TODO: what's the point of this callback disconnect is not async\n\n\n        if (disconnectCallback) disconnectCallback();\n      } // [SEND Frame](http://stomp.github.com/stomp-specification-1.1.html#SEND)\n      //\n      // * `destination` is MANDATORY.\n\n    }, {\n      key: 'send',\n      value: function send(destination) {\n        var body = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n        var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var hdrs = Object.assign({}, headers);\n        hdrs.destination = destination;\n\n        this._transmit('SEND', hdrs, body);\n      } // [BEGIN Frame](http://stomp.github.com/stomp-specification-1.1.html#BEGIN)\n      //\n      // If no transaction ID is passed, one will be created automatically\n\n    }, {\n      key: 'begin',\n      value: function begin() {\n        var transaction = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'tx-' + createId();\n\n        this._transmit('BEGIN', {\n          transaction: transaction\n        });\n\n        return {\n          id: transaction,\n          commit: this.commit.bind(this, transaction),\n          abort: this.abort.bind(this, transaction)\n        };\n      } // [COMMIT Frame](http://stomp.github.com/stomp-specification-1.1.html#COMMIT)\n      //\n      // * `transaction` is MANDATORY.\n      //\n      // It is preferable to commit a transaction by calling `commit()` directly on\n      // the object returned by `client.begin()`:\n      //\n      //     var tx = client.begin(txid);\n      //     ...\n      //     tx.commit();\n\n    }, {\n      key: 'commit',\n      value: function commit(transaction) {\n        this._transmit('COMMIT', {\n          transaction: transaction\n        });\n      } // [ABORT Frame](http://stomp.github.com/stomp-specification-1.1.html#ABORT)\n      //\n      // * `transaction` is MANDATORY.\n      //\n      // It is preferable to abort a transaction by calling `abort()` directly on\n      // the object returned by `client.begin()`:\n      //\n      //     var tx = client.begin(txid);\n      //     ...\n      //     tx.abort();\n\n    }, {\n      key: 'abort',\n      value: function abort(transaction) {\n        this._transmit('ABORT', {\n          transaction: transaction\n        });\n      } // [ACK Frame](http://stomp.github.com/stomp-specification-1.1.html#ACK)\n      //\n      // * `messageID` & `subscription` are MANDATORY.\n      //\n      // It is preferable to acknowledge a message by calling `ack()` directly\n      // on the message handled by a subscription callback:\n      //\n      //     client.subscribe(destination,\n      //       function(message) {\n      //         // process the message\n      //         // acknowledge it\n      //         message.ack();\n      //       },\n      //       {'ack': 'client'}\n      //     );\n\n    }, {\n      key: 'ack',\n      value: function ack(messageID, subscription) {\n        var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var hdrs = Object.assign({}, headers); // 1.2 change id header name from message-id to id\n\n        var idAttr = this.version === VERSIONS.V1_2 ? 'id' : 'message-id';\n        hdrs[idAttr] = messageID;\n        hdrs.subscription = subscription;\n\n        this._transmit('ACK', hdrs);\n      } // [NACK Frame](http://stomp.github.com/stomp-specification-1.1.html#NACK)\n      //\n      // * `messageID` & `subscription` are MANDATORY.\n      //\n      // It is preferable to nack a message by calling `nack()` directly on the\n      // message handled by a subscription callback:\n      //\n      //     client.subscribe(destination,\n      //       function(message) {\n      //         // process the message\n      //         // an error occurs, nack it\n      //         message.nack();\n      //       },\n      //       {'ack': 'client'}\n      //     );\n\n    }, {\n      key: 'nack',\n      value: function nack(messageID, subscription) {\n        var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var hdrs = Object.assign({}, headers); // 1.2 change id header name from message-id to id\n\n        var idAttr = this.version === VERSIONS.V1_2 ? 'id' : 'message-id';\n        hdrs[idAttr] = messageID;\n        hdrs.subscription = subscription;\n\n        this._transmit('NACK', hdrs);\n      } // [SUBSCRIBE Frame](http://stomp.github.com/stomp-specification-1.1.html#SUBSCRIBE)\n\n    }, {\n      key: 'subscribe',\n      value: function subscribe(destination, callback) {\n        var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n        var hdrs = Object.assign({}, headers); // for convenience if the `id` header is not set, we create a new one for this client\n        // that will be returned to be able to unsubscribe this subscription\n\n        if (!hdrs.id) hdrs.id = 'sub-' + createId();\n        hdrs.destination = destination;\n        this.subscriptions[hdrs.id] = callback;\n\n        this._transmit('SUBSCRIBE', hdrs);\n\n        return {\n          id: hdrs.id,\n          unsubscribe: this.unsubscribe.bind(this, hdrs.id)\n        };\n      } // [UNSUBSCRIBE Frame](http://stomp.github.com/stomp-specification-1.1.html#UNSUBSCRIBE)\n      //\n      // * `id` is MANDATORY.\n      //\n      // It is preferable to unsubscribe from a subscription by calling\n      // `unsubscribe()` directly on the object returned by `client.subscribe()`:\n      //\n      //     var subscription = client.subscribe(destination, onmessage);\n      //     ...\n      //     subscription.unsubscribe(headers);\n\n    }, {\n      key: 'unsubscribe',\n      value: function unsubscribe(id) {\n        var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n        var hdrs = Object.assign({}, headers);\n        delete this.subscriptions[id];\n        hdrs.id = id;\n\n        this._transmit('UNSUBSCRIBE', hdrs);\n      } // Clean up client resources when it is disconnected or the server did not\n      // send heart beats in a timely fashion\n\n    }, {\n      key: '_cleanUp',\n      value: function _cleanUp() {\n        this.connected = false;\n        clearInterval(this.pinger);\n        clearInterval(this.ponger);\n      } // Base method to transmit any stomp frame\n\n    }, {\n      key: '_transmit',\n      value: function _transmit(command, headers, body) {\n        var out = Frame.marshall(command, headers, body);\n        this.debug('>>> ' + out, {\n          frame: {\n            command: command,\n            headers: headers,\n            body: body\n          }\n        });\n\n        this._wsSend(out);\n      }\n    }, {\n      key: '_wsSend',\n      value: function _wsSend(data) {\n        if (this.isBinary) data = unicodeStringToTypedArray(data);\n        this.debug('>>> length ' + data.length); // if necessary, split the *STOMP* frame to send it on many smaller\n        // *WebSocket* frames\n\n        while (true) {\n          if (data.length > this.maxWebSocketFrameSize) {\n            this.ws.send(data.slice(0, this.maxWebSocketFrameSize));\n            data = data.slice(this.maxWebSocketFrameSize);\n            this.debug('remaining = ' + data.length);\n          } else {\n            return this.ws.send(data);\n          }\n        }\n      } // Heart-beat negotiation\n\n    }, {\n      key: '_setupHeartbeat',\n      value: function _setupHeartbeat(headers) {\n        var _this2 = this;\n\n        if (this.version !== VERSIONS.V1_1 && this.version !== VERSIONS.V1_2) return; // heart-beat header received from the server looks like:\n        //\n        //     heart-beat: sx, sy\n\n        var _split$map = (headers['heart-beat'] || '0,0').split(',').map(function (v) {\n          return parseInt(v, 10);\n        }),\n            _split$map2 = slicedToArray(_split$map, 2),\n            serverOutgoing = _split$map2[0],\n            serverIncoming = _split$map2[1];\n\n        if (!(this.heartbeat.outgoing === 0 || serverIncoming === 0)) {\n          var ttl = Math.max(this.heartbeat.outgoing, serverIncoming);\n          this.debug('send PING every ' + ttl + 'ms');\n          this.pinger = setInterval(function () {\n            _this2._wsSend(BYTES.LF);\n\n            _this2.debug('>>> PING');\n          }, ttl);\n        }\n\n        if (!(this.heartbeat.incoming === 0 || serverOutgoing === 0)) {\n          var _ttl = Math.max(this.heartbeat.incoming, serverOutgoing);\n\n          this.debug('check PONG every ' + _ttl + 'ms');\n          this.ponger = setInterval(function () {\n            var delta = Date.now() - _this2.serverActivity; // We wait twice the TTL to be flexible on window's setInterval calls\n\n\n            if (delta > _ttl * 2) {\n              _this2.debug('did not receive server activity for the last ' + delta + 'ms');\n\n              _this2.ws.close();\n            }\n          }, _ttl);\n        }\n      } // parse the arguments number and type to find the headers, connectCallback and\n      // (eventually undefined) errorCallback\n\n    }, {\n      key: '_parseConnect',\n      value: function _parseConnect() {\n        var headers = {},\n            connectCallback = void 0,\n            errorCallback = void 0;\n\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        switch (args.length) {\n          case 2:\n            headers = args[0];\n            connectCallback = args[1];\n            break;\n\n          case 3:\n            if (args[1] instanceof Function) {\n              headers = args[0];\n              connectCallback = args[1];\n              errorCallback = args[2];\n            } else {\n              headers.login = args[0];\n              headers.passcode = args[1];\n              connectCallback = args[2];\n            }\n\n            break;\n\n          case 4:\n            headers.login = args[0];\n            headers.passcode = args[1];\n            connectCallback = args[2];\n            errorCallback = args[3];\n            break;\n\n          default:\n            headers.login = args[0];\n            headers.passcode = args[1];\n            connectCallback = args[2];\n            errorCallback = args[3];\n            headers.host = args[4];\n        }\n\n        return [headers, connectCallback, errorCallback];\n      }\n    }]);\n    return Client;\n  }(); // The `webstomp` Object\n\n\n  var webstomp = {\n    Frame: Frame,\n    VERSIONS: VERSIONS,\n    // This method creates a WebSocket client that is connected to\n    // the STOMP server located at the url.\n    client: function client(url) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var ws = new WebSocket(url, options.protocols || VERSIONS.supportedProtocols());\n      return new Client(ws, options);\n    },\n    // This method is an alternative to `webstomp.client()` to let the user\n    // specify the WebSocket to use (either a standard HTML5 WebSocket or\n    // a similar object).\n    over: function over() {\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return new (Function.prototype.bind.apply(Client, [null].concat(args)))();\n    }\n  };\n  return webstomp;\n});","map":{"version":3,"sources":["C:/dev/by/proj51/node_modules/webstomp-client/dist/webstomp.js"],"names":["global","factory","exports","module","define","amd","webstomp","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_i","Symbol","iterator","_s","next","done","push","value","err","Array","isArray","toConsumableArray","arr2","from","VERSIONS","V1_0","V1_1","V1_2","supportedVersions","supportedProtocols","PROTOCOLS_VERSIONS","getSupportedVersion","protocol","debug","knownVersion","BYTES","LF","NULL","trim","str","replace","unicodeStringToTypedArray","s","escstr","encodeURIComponent","binstr","match","p1","String","fromCharCode","map","call","c","charCodeAt","Uint8Array","typedArrayToUnicodeString","ua","apply","m","p","code","toString","toUpperCase","decodeURIComponent","sizeOfUTF8","createId","ts","Date","getTime","rand","Math","floor","random","Frame","command","headers","arguments","body","_this","lines","skipContentLength","keys","forEach","name","join","unmarshallSingle","data","divider","search","RegExp","headerLines","substring","split","shift","bodyIndex","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","reverse","_step","line","idx","indexOf","return","len","parseInt","chr","charAt","unmarshall","datas","frames","firstFrames","slice","lastFrame","r","f","partial","marshall","frame","Client","ws","options","_options$binary","binary","_options$heartbeat","heartbeat","outgoing","incoming","_options$debug","_options$protocols","protocols","binaryType","isBinary","hasDebug","connected","maxWebSocketFrameSize","subscriptions","partialData","_console","console","log","connect","_parseConnect2","_parseConnect","_parseConnect3","connectCallback","errorCallback","onmessage","evt","ArrayBuffer","serverActivity","now","unmarshalledData","server","version","_setupHeartbeat","subscription","onreceive","messageID","ack","bind","nack","onreceipt","onclose","event","url","_cleanUp","onopen","_transmit","readyState","OPEN","disconnect","disconnectCallback","close","send","destination","hdrs","assign","begin","transaction","id","commit","abort","idAttr","subscribe","callback","unsubscribe","clearInterval","pinger","ponger","out","_wsSend","_this2","_split$map","v","_split$map2","serverOutgoing","serverIncoming","ttl","max","setInterval","_ttl","delta","_len","args","_key","Function","login","passcode","host","client","WebSocket","over","concat"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global.webstomp = factory());\n}(this, (function () { 'use strict';\n\n  var classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var slicedToArray = function () {\n    function sliceIterator(arr, i) {\n      var _arr = [];\n      var _n = true;\n      var _d = false;\n      var _e = undefined;\n\n      try {\n        for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n          _arr.push(_s.value);\n\n          if (i && _arr.length === i) break;\n        }\n      } catch (err) {\n        _d = true;\n        _e = err;\n      } finally {\n        try {\n          if (!_n && _i[\"return\"]) _i[\"return\"]();\n        } finally {\n          if (_d) throw _e;\n        }\n      }\n\n      return _arr;\n    }\n\n    return function (arr, i) {\n      if (Array.isArray(arr)) {\n        return arr;\n      } else if (Symbol.iterator in Object(arr)) {\n        return sliceIterator(arr, i);\n      } else {\n        throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n      }\n    };\n  }();\n\n  var toConsumableArray = function (arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n      return arr2;\n    } else {\n      return Array.from(arr);\n    }\n  };\n\n  var VERSIONS = {\n      V1_0: '1.0',\n      V1_1: '1.1',\n      V1_2: '1.2',\n      // Versions of STOMP specifications supported\n      supportedVersions: function supportedVersions() {\n          return '1.2,1.1,1.0';\n      },\n      supportedProtocols: function supportedProtocols() {\n          return ['v10.stomp', 'v11.stomp', 'v12.stomp'];\n      }\n  };\n\n  var PROTOCOLS_VERSIONS = {\n      'v10.stomp': VERSIONS.V1_0,\n      'v11.stomp': VERSIONS.V1_1,\n      'v12.stomp': VERSIONS.V1_2\n  };\n\n  function getSupportedVersion(protocol, debug) {\n      var knownVersion = PROTOCOLS_VERSIONS[protocol];\n      if (!knownVersion && debug) {\n          debug('DEPRECATED: ' + protocol + ' is not a recognized STOMP version. In next major client version, this will close the connection.');\n      }\n      // 2nd temporary fallback if the protocol\n      // does not match a supported STOMP version\n      // This fallback will be removed in next major version\n      return knownVersion || VERSIONS.V1_2;\n  }\n\n  // Define constants for bytes used throughout the code.\n  var BYTES = {\n      // LINEFEED byte (octet 10)\n      LF: '\\x0A',\n      // NULL byte (octet 0)\n      NULL: '\\x00'\n  };\n\n  // utility function to trim any whitespace before and after a string\n  var trim = function trim(str) {\n      return str.replace(/^\\s+|\\s+$/g, '');\n  };\n\n  // from https://coolaj86.com/articles/unicode-string-to-a-utf-8-typed-array-buffer-in-javascript/\n  function unicodeStringToTypedArray(s) {\n      var escstr = encodeURIComponent(s);\n      var binstr = escstr.replace(/%([0-9A-F]{2})/g, function (match, p1) {\n          return String.fromCharCode('0x' + p1);\n      });\n      var arr = Array.prototype.map.call(binstr, function (c) {\n          return c.charCodeAt(0);\n      });\n      return new Uint8Array(arr);\n  }\n\n  // from https://coolaj86.com/articles/unicode-string-to-a-utf-8-typed-array-buffer-in-javascript/\n  function typedArrayToUnicodeString(ua) {\n      var binstr = String.fromCharCode.apply(String, toConsumableArray(ua));\n      var escstr = binstr.replace(/(.)/g, function (m, p) {\n          var code = p.charCodeAt(0).toString(16).toUpperCase();\n          if (code.length < 2) {\n              code = '0' + code;\n          }\n          return '%' + code;\n      });\n      return decodeURIComponent(escstr);\n  }\n\n  // Compute the size of a UTF-8 string by counting its number of bytes\n  // (and not the number of characters composing the string)\n  function sizeOfUTF8(s) {\n      if (!s) return 0;\n      return encodeURIComponent(s).match(/%..|./g).length;\n  }\n\n  function createId() {\n      var ts = new Date().getTime();\n      var rand = Math.floor(Math.random() * 1000);\n      return ts + '-' + rand;\n  }\n\n  // [STOMP Frame](http://stomp.github.com/stomp-specification-1.1.html#STOMP_Frames) Class\n\n  var Frame = function () {\n\n      // Frame constructor\n      function Frame(command) {\n          var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n          var body = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n          classCallCheck(this, Frame);\n\n          this.command = command;\n          this.headers = headers;\n          this.body = body;\n      }\n\n      // Provides a textual representation of the frame\n      // suitable to be sent to the server\n\n\n      createClass(Frame, [{\n          key: 'toString',\n          value: function toString() {\n              var _this = this;\n\n              var lines = [this.command],\n                  skipContentLength = this.headers['content-length'] === false;\n              if (skipContentLength) delete this.headers['content-length'];\n\n              Object.keys(this.headers).forEach(function (name) {\n                  var value = _this.headers[name];\n                  lines.push(name + ':' + value);\n              });\n\n              if (this.body && !skipContentLength) {\n                  lines.push('content-length:' + sizeOfUTF8(this.body));\n              }\n\n              lines.push(BYTES.LF + this.body);\n\n              return lines.join(BYTES.LF);\n          }\n\n          // Unmarshall a single STOMP frame from a `data` string\n\n      }], [{\n          key: 'unmarshallSingle',\n          value: function unmarshallSingle(data) {\n              // search for 2 consecutives LF byte to split the command\n              // and headers from the body\n              var divider = data.search(new RegExp(BYTES.LF + BYTES.LF)),\n                  headerLines = data.substring(0, divider).split(BYTES.LF),\n                  command = headerLines.shift(),\n                  headers = {},\n                  body = '',\n\n              // skip the 2 LF bytes that divides the headers from the body\n              bodyIndex = divider + 2;\n\n              // Parse headers in reverse order so that for repeated headers, the 1st\n              // value is used\n              var _iteratorNormalCompletion = true;\n              var _didIteratorError = false;\n              var _iteratorError = undefined;\n\n              try {\n                  for (var _iterator = headerLines.reverse()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                      var line = _step.value;\n\n                      var idx = line.indexOf(':');\n                      headers[trim(line.substring(0, idx))] = trim(line.substring(idx + 1));\n                  }\n                  // Parse body\n                  // check for content-length or topping at the first NULL byte found.\n              } catch (err) {\n                  _didIteratorError = true;\n                  _iteratorError = err;\n              } finally {\n                  try {\n                      if (!_iteratorNormalCompletion && _iterator.return) {\n                          _iterator.return();\n                      }\n                  } finally {\n                      if (_didIteratorError) {\n                          throw _iteratorError;\n                      }\n                  }\n              }\n\n              if (headers['content-length']) {\n                  var len = parseInt(headers['content-length'], 10);\n                  body = ('' + data).substring(bodyIndex, bodyIndex + len);\n              } else {\n                  var chr = null;\n                  for (var i = bodyIndex; i < data.length; i++) {\n                      chr = data.charAt(i);\n                      if (chr === BYTES.NULL) break;\n                      body += chr;\n                  }\n              }\n\n              return new Frame(command, headers, body);\n          }\n\n          // Split the data before unmarshalling every single STOMP frame.\n          // Web socket servers can send multiple frames in a single websocket message.\n          // If the message size exceeds the websocket message size, then a single\n          // frame can be fragmented across multiple messages.\n          //\n          // `datas` is a string.\n          //\n          // returns an *array* of Frame objects\n\n      }, {\n          key: 'unmarshall',\n          value: function unmarshall(datas) {\n              // split and unmarshall *multiple STOMP frames* contained in a *single WebSocket frame*.\n              // The data is split when a NULL byte (followed by zero or many LF bytes) is found\n              var frames = datas.split(new RegExp(BYTES.NULL + BYTES.LF + '*')),\n                  firstFrames = frames.slice(0, -1),\n                  lastFrame = frames.slice(-1)[0],\n                  r = {\n                  frames: firstFrames.map(function (f) {\n                      return Frame.unmarshallSingle(f);\n                  }),\n                  partial: ''\n              };\n\n              // If this contains a final full message or just a acknowledgement of a PING\n              // without any other content, process this frame, otherwise return the\n              // contents of the buffer to the caller.\n              if (lastFrame === BYTES.LF || lastFrame.search(RegExp(BYTES.NULL + BYTES.LF + '*$')) !== -1) {\n                  r.frames.push(Frame.unmarshallSingle(lastFrame));\n              } else {\n                  r.partial = lastFrame;\n              }\n\n              return r;\n          }\n\n          // Marshall a Stomp frame\n\n      }, {\n          key: 'marshall',\n          value: function marshall(command, headers, body) {\n              var frame = new Frame(command, headers, body);\n              return frame.toString() + BYTES.NULL;\n          }\n      }]);\n      return Frame;\n  }();\n\n  // STOMP Client Class\n  //\n  // All STOMP protocol is exposed as methods of this class (`connect()`,\n  // `send()`, etc.)\n\n  var Client = function () {\n      function Client(ws) {\n          var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n          classCallCheck(this, Client);\n\n          // cannot have default options object + destructuring in the same time in method signature\n          var _options$binary = options.binary,\n              binary = _options$binary === undefined ? false : _options$binary,\n              _options$heartbeat = options.heartbeat,\n              heartbeat = _options$heartbeat === undefined ? { outgoing: 10000, incoming: 10000 } : _options$heartbeat,\n              _options$debug = options.debug,\n              debug = _options$debug === undefined ? true : _options$debug,\n              _options$protocols = options.protocols,\n              protocols = _options$protocols === undefined ? [] : _options$protocols;\n\n\n          this.ws = ws;\n          this.ws.binaryType = 'arraybuffer';\n          this.isBinary = !!binary;\n          this.hasDebug = !!debug;\n          this.connected = false;\n          // Heartbeat properties of the client\n          // outgoing: send heartbeat every 10s by default (value is in ms)\n          // incoming: expect to receive server heartbeat at least every 10s by default\n          // falsy value means no heartbeat hence 0,0\n          this.heartbeat = heartbeat || { outgoing: 0, incoming: 0 };\n          // maximum *WebSocket* frame size sent by the client. If the STOMP frame\n          // is bigger than this value, the STOMP frame will be sent using multiple\n          // WebSocket frames (default is 16KiB)\n          this.maxWebSocketFrameSize = 16 * 1024;\n          // subscription callbacks indexed by subscriber's ID\n          this.subscriptions = {};\n          this.partialData = '';\n          this.protocols = protocols;\n      }\n\n      // //// Debugging\n      //\n      // By default, debug messages are logged in the window's console if it is defined.\n      // This method is called for every actual transmission of the STOMP frames over the\n      // WebSocket.\n      //\n      // It is possible to set a `debug(message, data)` method\n      // on a client instance to handle differently the debug messages:\n      //\n      //     client.debug = function(str) {\n      //         // append the debug log to a #debug div\n      //         $(\"#debug\").append(str + \"\\n\");\n      //     };\n\n\n      createClass(Client, [{\n          key: 'debug',\n          value: function debug() {\n              var _console;\n\n              if (this.hasDebug) (_console = console).log.apply(_console, arguments);\n          }\n\n          // [CONNECT Frame](http://stomp.github.com/stomp-specification-1.1.html#CONNECT_or_STOMP_Frame)\n          //\n          // The `connect` method accepts different number of arguments and types:\n          //\n          // * `connect(headers, connectCallback)`\n          // * `connect(headers, connectCallback, errorCallback)`\n          // * `connect(login, passcode, connectCallback)`\n          // * `connect(login, passcode, connectCallback, errorCallback)`\n          // * `connect(login, passcode, connectCallback, errorCallback, host)`\n          //\n          // The errorCallback is optional and the 2 first forms allow to pass other\n          // headers in addition to `client`, `passcode` and `host`.\n\n      }, {\n          key: 'connect',\n          value: function connect() {\n              var _this = this;\n\n              var _parseConnect2 = this._parseConnect.apply(this, arguments),\n                  _parseConnect3 = slicedToArray(_parseConnect2, 3),\n                  headers = _parseConnect3[0],\n                  connectCallback = _parseConnect3[1],\n                  errorCallback = _parseConnect3[2];\n\n              this.connectCallback = connectCallback;\n              this.debug('Opening Web Socket...');\n              this.ws.onmessage = function (evt) {\n                  var data = evt.data;\n                  if (evt.data instanceof ArrayBuffer) {\n                      data = typedArrayToUnicodeString(new Uint8Array(evt.data));\n                  }\n                  _this.serverActivity = Date.now();\n                  // heartbeat\n                  if (data === BYTES.LF) {\n                      _this.debug('<<< PONG');\n                      return;\n                  }\n                  _this.debug('<<< ' + data);\n                  // Handle STOMP frames received from the server\n                  // The unmarshall function returns the frames parsed and any remaining\n                  // data from partial frames.\n                  var unmarshalledData = Frame.unmarshall(_this.partialData + data);\n                  _this.partialData = unmarshalledData.partial;\n                  unmarshalledData.frames.forEach(function (frame) {\n                      switch (frame.command) {\n                          // [CONNECTED Frame](http://stomp.github.com/stomp-specification-1.1.html#CONNECTED_Frame)\n                          case 'CONNECTED':\n                              _this.debug('connected to server ' + frame.headers.server);\n                              _this.connected = true;\n                              _this.version = frame.headers.version;\n                              _this._setupHeartbeat(frame.headers);\n                              if (connectCallback) connectCallback(frame);\n                              break;\n                          // [MESSAGE Frame](http://stomp.github.com/stomp-specification-1.1.html#MESSAGE)\n                          case 'MESSAGE':\n                              // the `onreceive` callback is registered when the client calls\n                              // `subscribe()`.\n                              // If there is registered subscription for the received message,\n                              // we used the default `onreceive` method that the client can set.\n                              // This is useful for subscriptions that are automatically created\n                              // on the browser side (e.g. [RabbitMQ's temporary\n                              // queues](http://www.rabbitmq.com/stomp.html)).\n                              var subscription = frame.headers.subscription;\n                              var onreceive = _this.subscriptions[subscription] || _this.onreceive;\n                              if (onreceive) {\n                                  // 1.2 define ack header if ack is set to client\n                                  // and this header must be used for ack/nack\n                                  var messageID = _this.version === VERSIONS.V1_2 && frame.headers.ack || frame.headers['message-id'];\n                                  // add `ack()` and `nack()` methods directly to the returned frame\n                                  // so that a simple call to `message.ack()` can acknowledge the message.\n                                  frame.ack = _this.ack.bind(_this, messageID, subscription);\n                                  frame.nack = _this.nack.bind(_this, messageID, subscription);\n                                  onreceive(frame);\n                              } else {\n                                  _this.debug('Unhandled received MESSAGE: ' + frame);\n                              }\n                              break;\n                          // [RECEIPT Frame](http://stomp.github.com/stomp-specification-1.1.html#RECEIPT)\n                          //\n                          // The client instance can set its `onreceipt` field to a function taking\n                          // a frame argument that will be called when a receipt is received from\n                          // the server:\n                          //\n                          //     client.onreceipt = function(frame) {\n                          //       receiptID = frame.headers['receipt-id'];\n                          //       ...\n                          //     }\n                          case 'RECEIPT':\n                              if (_this.onreceipt) _this.onreceipt(frame);\n                              break;\n                          // [ERROR Frame](http://stomp.github.com/stomp-specification-1.1.html#ERROR)\n                          case 'ERROR':\n                              if (errorCallback) errorCallback(frame);\n                              break;\n                          default:\n                              _this.debug('Unhandled frame: ' + frame);\n                      }\n                  });\n              };\n              this.ws.onclose = function (event) {\n                  _this.debug('Whoops! Lost connection to ' + _this.ws.url + ':', { event: event });\n                  _this._cleanUp();\n                  if (errorCallback) errorCallback(event);\n              };\n              this.ws.onopen = function () {\n                  _this.debug('Web Socket Opened...');\n                  // 1st protocol fallback on user 1st protocols options\n                  // to prevent edge case where server does not comply and respond with a choosen protocol\n                  // or when ws client does not handle protocol property very well\n                  headers['accept-version'] = getSupportedVersion(_this.ws.protocol || _this.protocols[0], _this.debug.bind(_this));\n                  // Check if we already have heart-beat in headers before adding them\n                  if (!headers['heart-beat']) {\n                      headers['heart-beat'] = [_this.heartbeat.outgoing, _this.heartbeat.incoming].join(',');\n                  }\n                  _this._transmit('CONNECT', headers);\n              };\n              if (this.ws.readyState === this.ws.OPEN) {\n                  this.ws.onopen();\n              }\n          }\n\n          // [DISCONNECT Frame](http://stomp.github.com/stomp-specification-1.1.html#DISCONNECT)\n\n      }, {\n          key: 'disconnect',\n          value: function disconnect(disconnectCallback) {\n              var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n              this._transmit('DISCONNECT', headers);\n              // Discard the onclose callback to avoid calling the errorCallback when\n              // the client is properly disconnected.\n              this.ws.onclose = null;\n              this.ws.close();\n              this._cleanUp();\n              // TODO: what's the point of this callback disconnect is not async\n              if (disconnectCallback) disconnectCallback();\n          }\n\n          // [SEND Frame](http://stomp.github.com/stomp-specification-1.1.html#SEND)\n          //\n          // * `destination` is MANDATORY.\n\n      }, {\n          key: 'send',\n          value: function send(destination) {\n              var body = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n              var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n              var hdrs = Object.assign({}, headers);\n              hdrs.destination = destination;\n              this._transmit('SEND', hdrs, body);\n          }\n\n          // [BEGIN Frame](http://stomp.github.com/stomp-specification-1.1.html#BEGIN)\n          //\n          // If no transaction ID is passed, one will be created automatically\n\n      }, {\n          key: 'begin',\n          value: function begin() {\n              var transaction = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'tx-' + createId();\n\n              this._transmit('BEGIN', { transaction: transaction });\n              return {\n                  id: transaction,\n                  commit: this.commit.bind(this, transaction),\n                  abort: this.abort.bind(this, transaction)\n              };\n          }\n\n          // [COMMIT Frame](http://stomp.github.com/stomp-specification-1.1.html#COMMIT)\n          //\n          // * `transaction` is MANDATORY.\n          //\n          // It is preferable to commit a transaction by calling `commit()` directly on\n          // the object returned by `client.begin()`:\n          //\n          //     var tx = client.begin(txid);\n          //     ...\n          //     tx.commit();\n\n      }, {\n          key: 'commit',\n          value: function commit(transaction) {\n              this._transmit('COMMIT', { transaction: transaction });\n          }\n\n          // [ABORT Frame](http://stomp.github.com/stomp-specification-1.1.html#ABORT)\n          //\n          // * `transaction` is MANDATORY.\n          //\n          // It is preferable to abort a transaction by calling `abort()` directly on\n          // the object returned by `client.begin()`:\n          //\n          //     var tx = client.begin(txid);\n          //     ...\n          //     tx.abort();\n\n      }, {\n          key: 'abort',\n          value: function abort(transaction) {\n              this._transmit('ABORT', { transaction: transaction });\n          }\n\n          // [ACK Frame](http://stomp.github.com/stomp-specification-1.1.html#ACK)\n          //\n          // * `messageID` & `subscription` are MANDATORY.\n          //\n          // It is preferable to acknowledge a message by calling `ack()` directly\n          // on the message handled by a subscription callback:\n          //\n          //     client.subscribe(destination,\n          //       function(message) {\n          //         // process the message\n          //         // acknowledge it\n          //         message.ack();\n          //       },\n          //       {'ack': 'client'}\n          //     );\n\n      }, {\n          key: 'ack',\n          value: function ack(messageID, subscription) {\n              var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n              var hdrs = Object.assign({}, headers);\n              // 1.2 change id header name from message-id to id\n              var idAttr = this.version === VERSIONS.V1_2 ? 'id' : 'message-id';\n              hdrs[idAttr] = messageID;\n              hdrs.subscription = subscription;\n              this._transmit('ACK', hdrs);\n          }\n\n          // [NACK Frame](http://stomp.github.com/stomp-specification-1.1.html#NACK)\n          //\n          // * `messageID` & `subscription` are MANDATORY.\n          //\n          // It is preferable to nack a message by calling `nack()` directly on the\n          // message handled by a subscription callback:\n          //\n          //     client.subscribe(destination,\n          //       function(message) {\n          //         // process the message\n          //         // an error occurs, nack it\n          //         message.nack();\n          //       },\n          //       {'ack': 'client'}\n          //     );\n\n      }, {\n          key: 'nack',\n          value: function nack(messageID, subscription) {\n              var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n              var hdrs = Object.assign({}, headers);\n              // 1.2 change id header name from message-id to id\n              var idAttr = this.version === VERSIONS.V1_2 ? 'id' : 'message-id';\n              hdrs[idAttr] = messageID;\n              hdrs.subscription = subscription;\n              this._transmit('NACK', hdrs);\n          }\n\n          // [SUBSCRIBE Frame](http://stomp.github.com/stomp-specification-1.1.html#SUBSCRIBE)\n\n      }, {\n          key: 'subscribe',\n          value: function subscribe(destination, callback) {\n              var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n              var hdrs = Object.assign({}, headers);\n              // for convenience if the `id` header is not set, we create a new one for this client\n              // that will be returned to be able to unsubscribe this subscription\n              if (!hdrs.id) hdrs.id = 'sub-' + createId();\n              hdrs.destination = destination;\n              this.subscriptions[hdrs.id] = callback;\n              this._transmit('SUBSCRIBE', hdrs);\n              return {\n                  id: hdrs.id,\n                  unsubscribe: this.unsubscribe.bind(this, hdrs.id)\n              };\n          }\n\n          // [UNSUBSCRIBE Frame](http://stomp.github.com/stomp-specification-1.1.html#UNSUBSCRIBE)\n          //\n          // * `id` is MANDATORY.\n          //\n          // It is preferable to unsubscribe from a subscription by calling\n          // `unsubscribe()` directly on the object returned by `client.subscribe()`:\n          //\n          //     var subscription = client.subscribe(destination, onmessage);\n          //     ...\n          //     subscription.unsubscribe(headers);\n\n      }, {\n          key: 'unsubscribe',\n          value: function unsubscribe(id) {\n              var headers = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n              var hdrs = Object.assign({}, headers);\n              delete this.subscriptions[id];\n              hdrs.id = id;\n              this._transmit('UNSUBSCRIBE', hdrs);\n          }\n\n          // Clean up client resources when it is disconnected or the server did not\n          // send heart beats in a timely fashion\n\n      }, {\n          key: '_cleanUp',\n          value: function _cleanUp() {\n              this.connected = false;\n              clearInterval(this.pinger);\n              clearInterval(this.ponger);\n          }\n\n          // Base method to transmit any stomp frame\n\n      }, {\n          key: '_transmit',\n          value: function _transmit(command, headers, body) {\n              var out = Frame.marshall(command, headers, body);\n              this.debug('>>> ' + out, { frame: { command: command, headers: headers, body: body } });\n              this._wsSend(out);\n          }\n      }, {\n          key: '_wsSend',\n          value: function _wsSend(data) {\n              if (this.isBinary) data = unicodeStringToTypedArray(data);\n              this.debug('>>> length ' + data.length);\n              // if necessary, split the *STOMP* frame to send it on many smaller\n              // *WebSocket* frames\n              while (true) {\n                  if (data.length > this.maxWebSocketFrameSize) {\n                      this.ws.send(data.slice(0, this.maxWebSocketFrameSize));\n                      data = data.slice(this.maxWebSocketFrameSize);\n                      this.debug('remaining = ' + data.length);\n                  } else {\n                      return this.ws.send(data);\n                  }\n              }\n          }\n\n          // Heart-beat negotiation\n\n      }, {\n          key: '_setupHeartbeat',\n          value: function _setupHeartbeat(headers) {\n              var _this2 = this;\n\n              if (this.version !== VERSIONS.V1_1 && this.version !== VERSIONS.V1_2) return;\n\n              // heart-beat header received from the server looks like:\n              //\n              //     heart-beat: sx, sy\n\n              var _split$map = (headers['heart-beat'] || '0,0').split(',').map(function (v) {\n                  return parseInt(v, 10);\n              }),\n                  _split$map2 = slicedToArray(_split$map, 2),\n                  serverOutgoing = _split$map2[0],\n                  serverIncoming = _split$map2[1];\n\n              if (!(this.heartbeat.outgoing === 0 || serverIncoming === 0)) {\n                  var ttl = Math.max(this.heartbeat.outgoing, serverIncoming);\n                  this.debug('send PING every ' + ttl + 'ms');\n                  this.pinger = setInterval(function () {\n                      _this2._wsSend(BYTES.LF);\n                      _this2.debug('>>> PING');\n                  }, ttl);\n              }\n\n              if (!(this.heartbeat.incoming === 0 || serverOutgoing === 0)) {\n                  var _ttl = Math.max(this.heartbeat.incoming, serverOutgoing);\n                  this.debug('check PONG every ' + _ttl + 'ms');\n                  this.ponger = setInterval(function () {\n                      var delta = Date.now() - _this2.serverActivity;\n                      // We wait twice the TTL to be flexible on window's setInterval calls\n                      if (delta > _ttl * 2) {\n                          _this2.debug('did not receive server activity for the last ' + delta + 'ms');\n                          _this2.ws.close();\n                      }\n                  }, _ttl);\n              }\n          }\n\n          // parse the arguments number and type to find the headers, connectCallback and\n          // (eventually undefined) errorCallback\n\n      }, {\n          key: '_parseConnect',\n          value: function _parseConnect() {\n              var headers = {},\n                  connectCallback = void 0,\n                  errorCallback = void 0;\n\n              for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                  args[_key] = arguments[_key];\n              }\n\n              switch (args.length) {\n                  case 2:\n                      headers = args[0];\n                      connectCallback = args[1];\n\n                      break;\n                  case 3:\n                      if (args[1] instanceof Function) {\n                          headers = args[0];\n                          connectCallback = args[1];\n                          errorCallback = args[2];\n                      } else {\n                          headers.login = args[0];\n                          headers.passcode = args[1];\n                          connectCallback = args[2];\n                      }\n                      break;\n                  case 4:\n                      headers.login = args[0];\n                      headers.passcode = args[1];\n                      connectCallback = args[2];\n                      errorCallback = args[3];\n\n                      break;\n                  default:\n                      headers.login = args[0];\n                      headers.passcode = args[1];\n                      connectCallback = args[2];\n                      errorCallback = args[3];\n                      headers.host = args[4];\n\n              }\n\n              return [headers, connectCallback, errorCallback];\n          }\n      }]);\n      return Client;\n  }();\n\n  // The `webstomp` Object\n  var webstomp = {\n      Frame: Frame,\n      VERSIONS: VERSIONS,\n      // This method creates a WebSocket client that is connected to\n      // the STOMP server located at the url.\n      client: function client(url) {\n          var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n          var ws = new WebSocket(url, options.protocols || VERSIONS.supportedProtocols());\n          return new Client(ws, options);\n      },\n\n      // This method is an alternative to `webstomp.client()` to let the user\n      // specify the WebSocket to use (either a standard HTML5 WebSocket or\n      // a similar object).\n      over: function over() {\n          for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = arguments[_key];\n          }\n\n          return new (Function.prototype.bind.apply(Client, [null].concat(args)))();\n      }\n  };\n\n  return webstomp;\n\n})));\n"]},"metadata":{},"sourceType":"script"}